/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * trocaSenhaOp.java
 *
 * Created on 19/01/2010, 18:34:05
 */

package Cadastro;
import auxiliar.conexao;
import javax.swing.JOptionPane;
import auxiliar.validaLogin;
/**
 *
 * @author ayrton monier
 */
public class trocaSenhaOp extends javax.swing.JDialog {

    private conexao con_trocaSenhaOp;
    private boolean grava;
    String nomeUsuario, situacao;
    String senhaCriptografada;

    int contador = 3;
    
    /** Creates new form trocaSenhaOp */
    public trocaSenhaOp(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();

        con_trocaSenhaOp = new conexao();
        con_trocaSenhaOp.conecta();

        try{
        con_trocaSenhaOp.executeSQL("select * from usuario where matricula_usuario = "+validaLogin.MATRICULA);
        con_trocaSenhaOp.resultset.first();

        //pega tipo de usuario e situacao
        nomeUsuario = con_trocaSenhaOp.resultset.getString("nome_usuario");
        situacao = con_trocaSenhaOp.resultset.getString("situacao");

        matricula.setText(validaLogin.MATRICULA);
        operador.setText(nomeUsuario);
        senhaAtual.requestFocus();

        }
        catch(Exception e){
        JOptionPane.showMessageDialog(null, "Erro = "+ e);
        
        }

    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();
        jLabel3 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        matricula = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        confSenhaNova = new javax.swing.JPasswordField();
        operador = new javax.swing.JTextField();
        contaConfSenha = new javax.swing.JLabel();
        senhaAtual = new javax.swing.JPasswordField();
        jLabel2 = new javax.swing.JLabel();
        contaSenha = new javax.swing.JLabel();
        senhaNova = new javax.swing.JPasswordField();
        jLabel7 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Trocar senha - Sistema Serquip 1.0");
        setIconImage(null);
        setIconImages(null);
        setResizable(false);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                formWindowClosing(evt);
            }
        });

        jPanel1.setBackground(new java.awt.Color(153, 153, 153));
        jPanel1.setBorder(javax.swing.BorderFactory.createBevelBorder(javax.swing.border.BevelBorder.RAISED));

        jLabel1.setFont(new java.awt.Font("Tahoma", 0, 17));
        jLabel1.setForeground(new java.awt.Color(255, 255, 255));
        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/senha.png"))); // NOI18N
        jLabel1.setText("Trocar senha de segurança");

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(62, 62, 62)
                .addComponent(jLabel1)
                .addContainerGap(77, Short.MAX_VALUE))
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGap(21, 21, 21)
                .addComponent(jLabel1)
                .addContainerGap(21, Short.MAX_VALUE))
        );

        jButton1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/ok22.png"))); // NOI18N
        jButton1.setToolTipText("Confirmar troca de senha");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jButton2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/imagens/cancelar22.png"))); // NOI18N
        jButton2.setToolTipText("Cancelar troca de senha");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        jPanel2.setBorder(javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED));

        jLabel3.setText("Nome:");

        jLabel5.setText("Matrícula :");

        matricula.setEditable(false);
        matricula.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                matriculaActionPerformed(evt);
            }
        });

        jLabel4.setText("Confimar Senha:");

        confSenhaNova.setEditable(false);
        confSenhaNova.setFont(new java.awt.Font("Tahoma", 1, 14));
        confSenhaNova.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                confSenhaNovaKeyReleased(evt);
            }
        });

        operador.setEditable(false);

        contaConfSenha.setText("(0)");

        senhaAtual.setFont(new java.awt.Font("Tahoma", 1, 14));
        senhaAtual.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                senhaAtualActionPerformed(evt);
            }
        });

        jLabel2.setText("Senha atual:");

        contaSenha.setText("(0)");

        senhaNova.setEditable(false);
        senhaNova.setFont(new java.awt.Font("Tahoma", 1, 14));
        senhaNova.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                senhaNovaActionPerformed(evt);
            }
        });
        senhaNova.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyReleased(java.awt.event.KeyEvent evt) {
                senhaNovaKeyReleased(evt);
            }
        });

        jLabel7.setText("Nova Senha:");

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                            .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel5)
                                .addComponent(jLabel3))
                            .addGap(34, 34, 34))
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addComponent(jLabel2)
                            .addGap(22, 22, 22))
                        .addGroup(jPanel2Layout.createSequentialGroup()
                            .addComponent(jLabel7)
                            .addGap(22, 22, 22)))
                    .addComponent(jLabel4))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(operador, javax.swing.GroupLayout.PREFERRED_SIZE, 252, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(matricula, javax.swing.GroupLayout.PREFERRED_SIZE, 84, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel2Layout.createSequentialGroup()
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(confSenhaNova)
                            .addComponent(senhaNova)
                            .addComponent(senhaAtual, javax.swing.GroupLayout.DEFAULT_SIZE, 84, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(contaSenha)
                            .addComponent(contaConfSenha))))
                .addGap(10, 10, 10))
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel5, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(matricula, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, 25, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(operador, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel3, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(senhaAtual, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.TRAILING))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(contaSenha, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel7, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(senhaNova, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(contaConfSenha, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(confSenhaNova, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 21, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        jLabel6.setForeground(new java.awt.Color(255, 0, 0));
        jLabel6.setText("Obs: A nova senha deve conter 8 números.");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(jLabel6, javax.swing.GroupLayout.DEFAULT_SIZE, 257, Short.MAX_VALUE)
                        .addGap(18, 18, 18)
                        .addComponent(jButton1)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jButton2, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jButton1)
                    .addComponent(jButton2)
                    .addComponent(jLabel6, javax.swing.GroupLayout.PREFERRED_SIZE, 14, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addContainerGap())
        );

        pack();
        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        java.awt.Dimension dialogSize = getSize();
        setLocation((screenSize.width-dialogSize.width)/2,(screenSize.height-dialogSize.height)/2);
    }// </editor-fold>//GEN-END:initComponents

    private void senhaAtualActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_senhaAtualActionPerformed
            
            boolean senhaAtualCorreta = false;


            if(senhaAtual.getText().isEmpty()){
                JOptionPane.showMessageDialog(null, "Informe a senha atual", "Aviso", JOptionPane.WARNING_MESSAGE);
                senhaAtual.setText("");
                senhaAtual.requestFocus();
            }
            else{

                try{

                    //testa pra ver se digitou letras
                    Integer.parseInt(senhaAtual.getText());

                    String senhaBancoAtual;

                    //criptografa a senha digitada para comparar com a do banco
                    criptografaSenha(senhaAtual.getText());

                    //query que pega a linha que contem os dados
                    con_trocaSenhaOp.executeSQL("select * from usuario where matricula_usuario = "+validaLogin.MATRICULA);
                    con_trocaSenhaOp.resultset.first();

                    do{
                        senhaBancoAtual = con_trocaSenhaOp.resultset.getString("senha_usuario");

                        if(senhaCriptografada.equals(senhaBancoAtual)){

                            senhaAtualCorreta = true;
                            break;
                        }


                    }while(con_trocaSenhaOp.resultset.next());

                        if(senhaAtualCorreta == true){
                            senhaAtual.setEditable(false);
                            senhaNova.setEditable(true);
                            confSenhaNova.setEditable(true);
                            senhaNova.requestFocus();
                            contador = 3;
                        }
                        else
                            seguranca();

                }
                catch(Exception e){
                    seguranca();

                }
        }//fim else


    }//GEN-LAST:event_senhaAtualActionPerformed

    private void matriculaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_matriculaActionPerformed

    }//GEN-LAST:event_matriculaActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        gravaNovaSenha();

    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        int opcao_escolhida = JOptionPane.showConfirmDialog(null, "DESEJA REALMENTE SAIR?", "Sair", JOptionPane.YES_NO_OPTION);

        if(opcao_escolhida == JOptionPane.YES_OPTION){
            con_trocaSenhaOp.desconecta();
            dispose();
        } else
            return;

    }//GEN-LAST:event_jButton2ActionPerformed

    private void confSenhaNovaKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_confSenhaNovaKeyReleased
        if(confSenhaNova.getText().toString().length() > 8){
            confSenhaNova.setText(confSenhaNova.getText().substring(0, 8));
            return;
        }
        else if(confSenhaNova.getText().isEmpty())
            contaConfSenha.setText("(0)");
        else
            contaConfSenha.setText("("+confSenhaNova.getText().toString().length()+")");
    }//GEN-LAST:event_confSenhaNovaKeyReleased

    private void formWindowClosing(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosing
        int opcao_escolhida = JOptionPane.showConfirmDialog(null, "DESEJA REALMENTE SAIR?", "Sair", JOptionPane.YES_NO_OPTION);

        if(opcao_escolhida == JOptionPane.YES_OPTION){
            con_trocaSenhaOp.desconecta();
            dispose();
        } else
            return;  
    }//GEN-LAST:event_formWindowClosing

    private void senhaNovaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_senhaNovaActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_senhaNovaActionPerformed

    private void senhaNovaKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_senhaNovaKeyReleased
        if(senhaNova.getText().toString().length() > 8){
            senhaNova.setText(senhaNova.getText().substring(0, 8));
            return;
        }
        else if(senhaNova.getText().isEmpty())
            contaSenha.setText("(0)");
        else
            contaSenha.setText("("+senhaNova.getText().toString().length()+")");
    }//GEN-LAST:event_senhaNovaKeyReleased

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                trocaSenhaOp dialog = new trocaSenhaOp(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    public javax.swing.JPasswordField confSenhaNova;
    private javax.swing.JLabel contaConfSenha;
    private javax.swing.JLabel contaSenha;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    public javax.swing.JTextField matricula;
    public javax.swing.JTextField operador;
    public javax.swing.JPasswordField senhaAtual;
    public javax.swing.JPasswordField senhaNova;
    // End of variables declaration//GEN-END:variables

public void verificaIncompatibilidade(){
    grava = false;
    String senhaAt, novaSen, confNovaSen;
    senhaAt = senhaAtual.getText();
    novaSen = senhaNova.getText();
    confNovaSen = confSenhaNova.getText();



    if(senhaAtual.isEditable()){
        JOptionPane.showMessageDialog(null, "Informe sua senha atual e pressione [enter]", "Aviso", JOptionPane.WARNING_MESSAGE);
        grava = false;
        senhaAtual.requestFocus();
        return;
    }


    else{
            //se nova senha for vazia e campo nova senha for editável ou se o campo nova senha tiver menos de 8 caracteres e for editavel
            if((novaSen.isEmpty() && senhaNova.isEditable()) || (novaSen.length() < 8 && senhaNova.isEditable())){
                JOptionPane.showMessageDialog(null, "Informe sua nova senha", "Aviso", JOptionPane.WARNING_MESSAGE);
                grava = false;
                senhaNova.requestFocus();
                return;
            }
            else if((confNovaSen.isEmpty() && confSenhaNova.isEditable()) || (confNovaSen.length() < 8 && confSenhaNova.isEditable())){
                JOptionPane.showMessageDialog(null, "confirme sua nova senha", "Aviso", JOptionPane.WARNING_MESSAGE);
                grava = false;
                confSenhaNova.requestFocus();
                return;
            }

            else if(novaSen.equals(confNovaSen) && (senhaNova.isEditable() == true && confSenhaNova.isEditable() == true))
                grava = true;

            else{
              JOptionPane.showMessageDialog(null, "Senhas incompatíveis", "Aviso", JOptionPane.WARNING_MESSAGE);
                  confSenhaNova.setText("");
                  senhaNova.setText("");

                  senhaNova.requestFocus();
                  contaSenha.setText("(0)");
                  contaConfSenha.setText("(0)");
                  grava = false;
                  return;
            }
    }

}
public void seguranca(){

    try{
        contador--;

        if(contador != 0){

        JOptionPane.showMessageDialog(null, "Senha atual incorreta. Você tem "+contador+" chance(s) para sua matricula não ser bloqueada!");
        senhaAtual.setText("");
        senhaAtual.requestFocus();

        }
        else{
            // se o gerente estiver bloqueado
            if(situacao.equals("Bloqueado") && validaLogin.USUARIO.equals("Gerente"))
                JOptionPane.showMessageDialog(null, "Por segurança sua matricula foi bloqueada e o sistema será fechado. Contate o Administrador!");

            // se o operador estiver bloqueado
            else if(situacao.equals("Bloqueado") && validaLogin.USUARIO.equals("Operador"))
                JOptionPane.showMessageDialog(null, "Por segurança sua matricula foi bloqueada e o sistema será fechado. Fale com o Gerente!");

            
            String sql = "UPDATE usuario SET situacao = 'Bloqueado' where matricula_usuario = "+matricula.getText();

            con_trocaSenhaOp.statement.executeUpdate(sql);
            con_trocaSenhaOp.desconecta();

            //procedimentos para gravar saida
            auxiliar.validaLogin.SITUACAO_LOGOUT = "Erro senha (troca)";
            principal.telaAcesso.guardaLogout();
            //fecha sistema
            System.exit(this.EXIT_ON_CLOSE);

        }
    }
    catch(Exception e){
        JOptionPane.showMessageDialog(null, "Erro ao tentar executar processo de segurança.\n\nErro: "+e);
    }



}
public void gravaNovaSenha(){

   verificaIncompatibilidade();

   if(grava == true){
   try{

        String sql = "UPDATE usuario SET senha_usuario = PASSWORD('"+senhaNova.getText()+"') where matricula_usuario = "+matricula.getText();
   
        int atualizado = con_trocaSenhaOp.statement.executeUpdate(sql);

        if(atualizado == 1){
            JOptionPane.showMessageDialog(null, "Senha atualizada com sucesso");
            dispose();
        }
   }

   catch(Exception e){
        JOptionPane.showMessageDialog(null, "Senha não atualizada, tente outra vez. ", "Aviso", JOptionPane.WARNING_MESSAGE);
   }
   }
}

public void criptografaSenha(String senha){

    con_trocaSenhaOp.executeSQL("select password('"+senha+"') as 'senha_criptografada'");
    try{
        con_trocaSenhaOp.resultset.first();

        senhaCriptografada = con_trocaSenhaOp.resultset.getString("senha_criptografada");
    }
    catch(Exception e){
        System.out.println("A senha não pode ser criptografada.\nErro: "+e);

    }

}

}
